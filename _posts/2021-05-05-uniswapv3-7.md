---
layout:     post
title:      Uniswap v3 的小彩蛋：仓位 NFT 和 migrator 迁移工具
subtitle:
date:       2021-05-05 20:44:00
author:     Paco
catalog:    true
header-img: img/in-post/uniswap-v3/uniswap.png
permalink:  /uniswap-v3-7/
tags:
    - Solidity
    - Ethereum
---

# Alpah leak

距离之前的 Uniswap v3 详解系列分析已经过了一个月。这期间 uniswap-v3-periphery 仓库的合约更新了很多代码。据粗浅观察，主要有以下几个改动：

- 优化了 LP Token，由之前的普通 ERC721 token 变成了带动态效果 SVG 图片的 NFT token
- 增加了一个 migrator 合约，可以从 uniswap v2 或者类 uniswap v2（说的就是你，sushiswap）一键迁移 LP 到 v3 中

## NFT Token

Uniswap v3 在生成 NFT Token 时，会根据提供 LP 的仓位信息，生成一个专属的 NFT Token. 其效果如下：

![nft-token](https://raw.githubusercontent.com/Uniswap/uniswap-v3-periphery/main/test/__snapshots__/NFTDescriptor.svg)

值得注意的是，我们常见的 NFT 都是将图片或视频预先保存在 IPFS 或类似去中心化存储平台中。而 Uniswap v3 的这些 LP NFT 中的动态效果都是通过动态生成 svg 来实现的。即在合约中通过 LP 的元信息，生成一个 svg 矢量图并将其编码到 NFT token 中。

这个 NFT token 会随着 LP 信息不同而产生一些不同的效果，例如曲线效果，颜色，文字内容等。

NFT token 中还加入了一个小彩蛋，有概率生成一个带闪光特效的图片，使用的随机算法可以参考[代码](https://github.com/Uniswap/uniswap-v3-periphery/blob/464a8a49611272f7349c970e0fadb7ec1d3c1086/contracts/libraries/NFTSVG.sol#L386-L406)。因为这些特效的效果编码到了 SVG 中，具体的实现效果如何只能等官方来揭晓了。

## Migrator

v3 中还新增了一个 `migrator` 合约，这个合约比较简单，可以一键将 uniswap v2 的 LP 迁移成为 v3 LP，并且它是可以用来迁移所有 uniswap v2 兼容 AMM 的 LP. 它很大概率会被用来针对 sushiswap，让用户从 sushiswap 迁移到 uniswap v3 中去。


